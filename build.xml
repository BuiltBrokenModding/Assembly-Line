<?xml version="1.0" encoding="UTF-8" ?>

<project name="Assembly%20Line" default="build">

	<property file="build.properties" />
	<property environment="env" />
	<property name="file.EEjar" value= "AssemblyLine_v${version.mod.major}.${version.mod.minor}.${version.mod.revis}.${env.BUILD_NUMBER}.jar" />

	<target name="build">

		<delete dir="contents" />
		<delete dir="build" />
        <delete dir="download" />
		<delete dir="${dir.development}/forge" />
		
		<copy todir="${dir.development}">
			<fileset dir="../Minecraft Forge/" />
		</copy>
        
        <mkdir dir="download" />
        <mkdir dir="download/cc" />
        
        <get src="https://github.com/DarkGuardsman/Dark-Library/archive/master.zip" dest="download" usetimestamp="True"/>
        <unzip dest="download/unzip/.." src="download/master.zip"/>
        <get src="http://ic2api.player.to:8080/job/IC2/lastSuccessfulBuild/artifact/packages/${dir.ic}" dest="download" usetimestamp="True"/>
        <unzip dest="download/unzip/.." src="download/${dir.ic}"/>
        <get src="${dir.bc}" dest="download" usetimestamp="True"/>
        <unzip dest="download/unzip/.." src="download/master.zip"/>
        <get src="${dir.cc}" dest="download" usetimestamp="True"/>
        <unzip dest="download/cc/" src="download/ComputerCraft.zip"/>
        
		<copy todir="${dir.mcp}/src/minecraft">
			
			<fileset dir="${dir.development}src">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
			
			<fileset dir="${dir.development}../Universal Electricity/src">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
            
             <fileset dir="download/Dark-Library-master/src/minecraft/">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
            
             <fileset dir="download/cc/api/src/dan200">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
            
             <fileset dir="download/ic2">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
            
             <fileset dir="download/BuildCraft-master/common/buildcraft/api">
				<exclude name=".git/**"/>
				<exclude name="**/*.xml"/>
			</fileset>
		</copy>
		
		<mkdir dir="contents" />
		<mkdir dir="build" />
		
		<replace dir="${dir.mcp}/src/minecraft" token="@MAJOR@" value="${version.mod.major}" />
		<replace dir="${dir.mcp}/src/minecraft" token="@MINOR@" value="${version.mod.minor}" />
		<replace dir="${dir.mcp}/src/minecraft" token="@REVIS@" value="${version.mod.revis}" />
		<replace dir="${dir.mcp}/src/minecraft" token="@BUILD@" value="${env.BUILD_NUMBER}" />

		<exec dir="${dir.mcp}" executable="cmd" osfamily="windows">
			<arg line="recompile.bat" />
		</exec>
		<exec dir="${dir.mcp}" executable="cmd" osfamily="windows">
			<arg line="reobfuscate_srg.bat" />
		</exec>
		
		<exec dir="${dir.mcp}" executable="bash" osfamily="unix">
			<arg line="recompile.sh" />
		</exec>
		<exec dir="${dir.mcp}" executable="bash" osfamily="unix">
			<arg line="reobfuscate_srg.sh" />
		</exec>

		<copy todir="contents">
			<fileset dir="${dir.mcp}/reobf/minecraft" excludes=".git/**">
				<exclude name="**/BCLoader.class"/>
			</fileset>
		
			<fileset dir="${dir.development}resources">
				<exclude name=".git/**"/>
                <exclude name="**/*.tcn"/>
				<exclude name="**/*.java"/>
				<exclude name="**/*.xml"/>
			</fileset>
		
			<fileset dir="${dir.development}../Universal Electricity/resources">
				<exclude name=".git/**"/>
				<exclude name="**/*.java"/>
				<exclude name="**/*.xml"/>
                
            <fileset dir="download/Dark-Library-master/resources">
				<exclude name=".git/**"/>
				<exclude name="**/*.java"/>
				<exclude name="**/*.xml"/>
			</fileset>
            
			</fileset>

		</copy>

		<jar destfile="output/${file.EEjar}">
			<fileset dir="contents" />
		</jar>
		
		<echo file="${env.JENKINS_HOME}/jobs/${env.JOB_NAME}/info.txt" append="true" >
		@ ${env.BUILD_NUMBER} ${version.minecraft} ${file.EEjar}</echo>
		
		<copy todir="output" file="build.properties" />
	</target>
</project>
